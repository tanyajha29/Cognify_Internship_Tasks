<!doctype html><html><head><meta charset="utf-8"><title>Tasks</title><link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet"><link rel="stylesheet" href="/css/material.css"></head><body>
<nav class="blue darken-2"><div class="nav-wrapper container"><a href="/" class="brand-logo">TaskFlow</a><ul class="right"><li><a href="/login">Login</a></li></ul></div></nav>

<main class="container" style="margin-top:20px">
  <div class="row">
    <div class="col s12 m8">
      <div class="card"><div class="card-content"><span class="card-title">Tasks</span>
        <div id="tasksList">Loadingâ€¦</div>
        <hr>
        <div class="input-field"><input id="newTitle"><label for="newTitle">Title</label></div>
        <div class="input-field"><textarea id="newDesc" class="materialize-textarea"></textarea><label for="newDesc">Description</label></div>
        <button id="createBtn" class="btn">Add task</button>
      </div></div>
    </div>
  </div>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script src="/js/tasks-api.js"></script>
<script>
async function loadTasks(){
  const list = document.getElementById('tasksList');
  list.innerHTML = 'Loading...';
  try {
    const tasks = await ApiClient.fetchTasks();
    if (!tasks.length) { list.innerHTML = '<p>No tasks yet</p>'; return; }
    list.innerHTML = '';
    tasks.forEach(t=>{
      const card = document.createElement('div'); card.className='card task-card';
      card.innerHTML = `<div class="card-content"><span class="card-title">${t.title}</span><p>${t.description||''}</p><div class="right"><a class="btn-small grey" data-id="${t._id}" data-act="edit">Edit</a> <a class="btn-small red" data-id="${t._id}" data-act="del">Delete</a></div></div>`;
      list.appendChild(card);
    });
  } catch(e) { M.toast({html: e.error || 'Failed to load tasks', classes: 'red'}); list.innerHTML='Error loading tasks'; }
}
document.getElementById('createBtn').addEventListener('click', async ()=>{
  const title=document.getElementById('newTitle').value.trim(); const desc=document.getElementById('newDesc').value.trim();
  if(!title){ M.toast({html:'Title required', classes:'red'}); return; }
  try{ await ApiClient.createTask(title,desc); M.toast({html:'Created', classes:'green'}); document.getElementById('newTitle').value=''; document.getElementById('newDesc').value=''; loadTasks(); }catch(err){ M.toast({html:err.error||'Create failed', classes:'red'}); }
});
document.addEventListener('click', async (e)=>{
  const btn = e.target.closest('a[data-act]');
  if(!btn) return;
  const id = btn.dataset.id;
  const act = btn.dataset.act;
  if(act==='del' && confirm('Delete?')){ try{ await ApiClient.deleteTask(id); M.toast({html:'Deleted', classes:'green'}); loadTasks(); }catch(err){ M.toast({html:err.error||'Delete failed', classes:'red'}); } }
  if(act==='edit'){ const newTitle=prompt('Title', btn.closest('.card').querySelector('.card-title').innerText); if(newTitle===null) return; const newDesc=prompt('Description',''); try{ await ApiClient.updateTask(id,{title:newTitle,description:newDesc}); M.toast({html:'Updated', classes:'green'}); loadTasks(); }catch(err){ M.toast({html:err.error||'Update failed', classes:'red'}); } }
});
document.addEventListener('DOMContentLoaded', ()=>{ M.updateTextFields(); loadTasks(); });
</script>
</body></html>
